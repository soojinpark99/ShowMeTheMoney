<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Show me the Money</title>
  </head>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .layout {
      width: 430px;
      height: 926px;
      margin: 50px auto;
      padding: 15px;
      background-color: #fafaf9;
      position: relative;
    }

    .calendar {
      width: 400px;
      margin: 10px auto;

      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-header {
      display: flex;
      justify-content: center;
    }

    .total-div > div {
      margin-bottom: 5px;
    }

    .day {
      text-align: center;
      margin-bottom: 10px;
    }
    .date,
    .empty {
      aspect-ratio: 1;
    }

    .date {
      cursor: pointer;
    }

    .date:hover {
      background-color: #e6e6e6;
    }

    .write-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      right: 20px;
      bottom: 20px;

      background-color: black;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 25px;
      cursor: pointer;
    }

    .detail-div {
      background-color: white;
      width: 100%;
      height: 80px;
    }

    .money {
      font-size: 30px;
    }
  </style>
  <body>
    <div class="layout">
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="prevBtn">이전</button>
          <h2 id="currentMonth"></h2>
          <button id="nextBtn">다음</button>
        </div>
        <div class="total-div">
          <div class="income">수입</div>
          <div class="expense">지출</div>
          <div class="total">합계</div>
        </div>
        <div class="calendar days">
          <div class="day">일</div>
          <div class="day">월</div>
          <div class="day">화</div>
          <div class="day">수</div>
          <div class="day">목</div>
          <div class="day">금</div>
          <div class="day">토</div>
        </div>
        <div class="calendar dates" id="calendarDates"></div>
      </div>
      <div class="details"></div>
      <a class="write-btn" href="./write.html">글쓰기</a>
    </div>
    <script>
      const today = new Date();
      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();

      // --- 데이터 받아오기 ---

      // const res = await fetch('/datas');
      // const datas = res.json();

      const datas = [
        {
          division: "expense",
          money: "13000",
          date: "2024-02-22",
          category: "food",
          memo: "배달의 민족",
        },
        {
          division: "expense",
          money: "1000",
          date: "2024-02-21",
          category: "food",
          memo: "편의점",
        },
        {
          division: "expense",
          money: "18000",
          date: "2024-02-23",
          category: "culture",
          memo: "영화",
        },
      ];

      // --- 선택한 날짜의 데이터 렌더링해서 화면에 추가 ---
      function renderData(currentDate = new Date().getDate()) {
        const filteredData = datas.filter((data) => {
          const dataDate = new Date(data.date);
          return (
            dataDate.getFullYear() === currentYear &&
            dataDate.getMonth() === currentMonth &&
            dataDate.getDate() === currentDate
          );
        });

        const details = document.querySelector(".details");
        details.innerHTML = "";

        filteredData.forEach((data) => {
          const div = document.createElement("div");
          div.classList.add("detail-div");

          const money = document.createElement("div");
          money.textContent = data.money;
          money.classList.add("money");

          details.append(div);
          div.append(money);
          div.append(data.category);
          div.append(data.memo);
        });
      }

      // --- 달력 동적 생성 ---
      function renderCalendar() {
        const calendarDates = document.getElementById("calendarDates");
        const currentMonthElement = document.getElementById("currentMonth");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const details = document.querySelector(".details");

        function renderDates() {
          const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
          const daysInMonth = new Date(
            currentYear,
            currentMonth + 1,
            0
          ).getDate();

          const startDayOfWeek = firstDayOfMonth.getDay();

          currentMonthElement.textContent = `${currentYear}년 ${
            currentMonth + 1
          }월`;

          calendarDates.innerHTML = "";

          for (let i = 0; i < startDayOfWeek; i++) {
            const emptyDate = document.createElement("div");
            emptyDate.classList.add("empty");
            calendarDates.appendChild(emptyDate);
          }

          for (let i = 1; i <= daysInMonth; i++) {
            const dateElement = document.createElement("div");
            dateElement.classList.add("date");
            dateElement.textContent = i;
            calendarDates.appendChild(dateElement);
          }
        }

        renderDates();

        prevBtn.addEventListener("click", () => {
          currentMonth--;
          if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
          }
          renderDates();
          details.innerHTML = "";
          renderData();
        });

        nextBtn.addEventListener("click", () => {
          currentMonth++;
          if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
          }
          renderDates();
          details.innerHTML = "";
          renderData();
        });
      }

      renderCalendar();
      renderData();
      document
        .getElementById("calendarDates")
        .addEventListener("click", (event) => {
          const clickedDate = parseInt(event.target.textContent);
          renderData(clickedDate);
        });
    </script>
  </body>
</html>
